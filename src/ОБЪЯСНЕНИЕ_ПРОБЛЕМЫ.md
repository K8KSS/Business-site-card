# 🔍 Объяснение проблемы HTTP 404

## Что происходит сейчас?

```
┌─────────────┐          HTTP запрос           ┌─────────────┐
│   Браузер   │ ─────────────────────────────> │  Supabase   │
│ (localhost) │                                 │   Cloud     │
└─────────────┘                                 └─────────────┘
                                                       │
                                                       │
                                                   ❌ 404
                                               Edge Function
                                               НЕ развернута!
```

### Почему так происходит?

1. **Вы запускаете сайт локально** через `START.bat` (Vite dev server на localhost)
2. **Фронтенд пытается обратиться к API** в Supabase Cloud
3. **Но Edge Functions не развернуты** в вашем Supabase проекте
4. **Результат:** HTTP 404 - Not Found

### Почему раньше всё работало?

В коде есть **fallback на демо-данные**, поэтому сайт частично работает:
- ✅ Показывает демо-публикации
- ✅ Показывает демо-альбомы
- ✅ Показывает демо-отзывы

Но **НЕ работает**:
- ❌ Загрузка файлов
- ❌ Редактирование через админ-панель
- ❌ Сохранение изменений
- ❌ Обновление фотографий
- ❌ Отправка отзывов

---

## Как это должно работать?

```
┌─────────────┐          HTTP запрос           ┌─────────────┐
│   Браузер   │ ─────────────────────────────> │  Supabase   │
│ (localhost) │                                 │   Cloud     │
└─────────────┘ <────────────────────────────  └─────────────┘
                      JSON ответ                      │
                                                       │
                                                   ✅ 200 OK
                                               Edge Function
                                                 работает!
```

После развертывания Edge Functions:
1. ✅ Все API запросы работают
2. ✅ Можно редактировать контент
3. ✅ Можно загружать файлы
4. ✅ Админ-панель полностью функциональна
5. ✅ Изменения сохраняются в базе данных

---

## Архитектура проекта

### Текущая структура:

```
Ваш проект
│
├── Фронтенд (React + Vite)          ← запускается локально
│   ├── App.tsx
│   ├── components/
│   └── utils/supabase/client.tsx    ← делает запросы к API
│
└── Бэкенд (Edge Functions)          ← НЕ развернут! ❌
    └── supabase/functions/server/   
        ├── index.tsx                ← основной API
        ├── kv_store.tsx             ← база данных (KV)
        └── init-demo-data.tsx       ← инициализация данных
```

### Что нужно сделать:

**Развернуть Edge Functions в Supabase Cloud:**

```bash
supabase functions deploy make-server-322de762
```

После этого структура станет:

```
Ваш проект
│
├── Фронтенд (localhost)             ← работает локально
│   └── делает запросы ──────────┐
│                                 │
└── Бэкенд (Supabase Cloud)  <───┘   ← развернут! ✅
    └── Edge Function работает
        └── База данных (KV) работает
```

---

## Технические детали

### URL API:
```
https://oqazxfewxttctehgftuy.supabase.co/functions/v1/make-server-322de762
```

### Эндпоинты, которые НЕ работают без деплоя:

- ❌ `/api/publications` - публикации
- ❌ `/api/albums` - альбомы
- ❌ `/api/portfolio` - портфолио
- ❌ `/api/reviews` - отзывы
- ❌ `/api/achievements` - достижения
- ❌ `/api/audio` - аудио
- ❌ `/api/videos` - видео
- ❌ `/api/messages` - сообщения
- ❌ `/api/pages/:id` - страницы
- ❌ `/api/upload` - загрузка файлов
- ❌ `/api/stats` - статистика

### После деплоя все эти эндпоинты заработают! ✅

---

## Почему не использовать локальный сервер?

В проекте есть файлы `/server/index.js`, но они **НЕ используются**, потому что:

1. Мигрировали на Supabase Edge Functions
2. Edge Functions поддерживают Deno (современнее Node.js)
3. Edge Functions автоматически масштабируются
4. Нет необходимости поднимать отдельный сервер

---

## Следующие шаги

### ✅ Вариант 1: Полноценное решение (рекомендуется)

1. Установите Supabase CLI
2. Запустите `DEPLOY_EDGE_FUNCTIONS.bat`
3. Проверьте работу: `/health` эндпоинт
4. Запустите сайт: `START.bat`

### 🔄 Вариант 2: Временное решение (демо-режим)

Ничего не делайте - сайт работает с демо-данными, но:
- Админ-панель не работает
- Изменения не сохраняются
- Загрузка файлов не работает

### 🏠 Вариант 3: Локальная разработка

```bash
supabase init
supabase start
supabase functions serve
```

Но потребуется изменить конфигурацию в `/utils/supabase/client.tsx`.

---

## FAQ

### Q: Можно ли работать вообще без бэкенда?
**A:** Да, но только в режиме просмотра. Редактирование не будет работать.

### Q: Сколько стоит Supabase?
**A:** Бесплатный план (Free Tier) включает:
- 500 MB базы данных
- 1 GB хранилища файлов  
- 2 GB трансфера
- 500,000 Edge Function вызовов/месяц

Для этого проекта Free Tier более чем достаточно!

### Q: Безопасно ли хранить данные в Supabase?
**A:** Да, Supabase использует PostgreSQL, шифрование, и автоматические бэкапы.

### Q: Нужно ли каждый раз делать деплой?
**A:** Нет, только при изменении кода Edge Functions. После деплоя они работают постоянно.

---

## Резюме

**Проблема:** Edge Functions не развернуты → HTTP 404  
**Решение:** Развернуть Edge Functions → всё работает  
**Как:** Запустить `DEPLOY_EDGE_FUNCTIONS.bat`  
**Время:** 5 минут  
**Цена:** Бесплатно (Free Tier)  

🚀 Удачи!
